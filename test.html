<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Capture</title>
</head>
<body>

<h2>Tap the button to start</h2>
<button id="startBtn">Start Capture</button>

<p id="status"></p>

<video id="video" width="300" autoplay playsinline></video>
<canvas id="canvas" width="300" height="300" style="display:none;"></canvas>

<img id="photo" style="width:300px; margin-top:10px;" />

<p id="location"></p>

<script>
async function startCamera() {
  const video = document.getElementById("video");
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: { ideal: "user" } },
      audio: false
    });
    video.srcObject = stream;
    document.getElementById("status").innerText = "Camera started!";
  } catch (e) {
    document.getElementById("status").innerText = "Camera error: " + e;
  }
}

function captureImage() {
  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  const imageData = canvas.toDataURL("image/png");
  document.getElementById("photo").src = imageData;
}

function getLocation() {
  navigator.geolocation.getCurrentPosition(
    (pos) => {
      document.getElementById("location").innerText =
        "Lat: " + pos.coords.latitude + 
        " Lon: " + pos.coords.longitude;
    },
    (err) => {
      document.getElementById("location").innerText =
        "Location error: " + err.message;
    }
  );
}

document.getElementById("startBtn").onclick = async () => {
  await startCamera();

  setTimeout(() => {
    captureImage();
    getLocation();
    document.getElementById("status").innerText = "Capture completed!";
  }, 2000);
};
</script>

</body>
</html>
